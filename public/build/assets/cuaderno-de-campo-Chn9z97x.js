document.addEventListener("alpine:init",()=>{Alpine.store("cuaderno")||Alpine.store("cuaderno",{summary:{items:[],get total(){return this.items.reduce((t,e)=>t+parseInt(e.cantidad),0)}},addMovementToSummary(t){const e=this.summary.items.find(i=>i.especie_id==t.especie_id&&i.categoria_id==t.categoria_id&&i.raza_id==t.raza_id&&i.motivo_movimiento_id==t.motivo_movimiento_id&&i.destino_traslado==t.destino_traslado);e?e.cantidad=parseInt(e.cantidad)+parseInt(t.cantidad):this.summary.items.push(t)},removeMovementFromSummary(t){const e=this.summary.items.findIndex(i=>i.id===t);e>-1&&this.summary.items.splice(e,1)},clearSummary(){this.summary.items=[]}}),Alpine.data("cuadernoDeCampo",t=>({unidadesProductivas:t.unidadesProductivasData,stockActualPorUP:t.stockActualPorUPData,especies:t.especiesData,categorias:t.categoriasData,razas:t.razasData,motivos:t.motivosData,selectedUpId:t.selectedUpId||null,showModal:!1,registrationType:null,showTotalStock:!1,showMovimientosGuardados:!1,dayFilter:"todos",dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],form:{especie_id:"",categoria_id:"",raza_id:"",cantidad:1,motivo_movimiento_id:"",destino_traslado:""},get selectedUp(){return this.selectedUpId?this.unidadesProductivas.find(e=>e.id==this.selectedUpId):null},get filteredMovements(){return this.$store.cuaderno.summary.items},get selectedStock(){return this.stockActualPorUP[this.selectedUpId]||[]},get filteredCategorias(){return this.form.especie_id?this.categorias.filter(e=>e.especie_id==this.form.especie_id):[]},get filteredRazas(){return this.form.especie_id?this.razas.filter(e=>e.especie_id==this.form.especie_id):[]},openModal(e){this.registrationType=e,this.showModal=!0},addMovement(){var o;if(!this.form.especie_id||!this.form.categoria_id||!this.form.raza_id||!this.form.motivo_movimiento_id||this.form.cantidad<1){Alpine.store("notification").notify("Por favor, complete todos los campos del formulario.",!0);return}const e=(o=this.motivos[this.registrationType.slice(0,-1)])==null?void 0:o.find(s=>s.id==this.form.motivo_movimiento_id);if(e&&e.nombre.toLowerCase().includes("traslado")&&!this.form.destino_traslado){Alpine.store("notification").notify("El destino del traslado es obligatorio para este motivo.",!0);return}const i=this.especies.find(s=>s.id==this.form.especie_id),r=this.categorias.find(s=>s.id==this.form.categoria_id),a=this.razas.find(s=>s.id==this.form.raza_id),d={id:Date.now()+Math.random(),...this.form,especie_nombre:i.nombre,categoria_nombre:r.nombre,raza_nombre:a.nombre,motivo_nombre:e?e.nombre:"N/A",tipo:this.registrationType,createdAt:new Date};Alpine.store("cuaderno").addMovementToSummary(d),this.showModal=!1,this.form={especie_id:"",categoria_id:"",raza_id:"",cantidad:1,motivo_movimiento_id:"",destino_traslado:""}},cancelChanges(){Alpine.store("cuaderno").clearSummary()},updateMovimientosGuardados(){if(!this.selectedUpId)return;const e=new URL(t.filtrarUrl);e.searchParams.append("day_filter",this.dayFilter),this.$refs.movimientosGuardadosBody.innerHTML='<tr><td colspan="6" class="text-center p-4">Cargando...</td></tr>',fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(i=>i.text()).then(i=>{this.$refs.movimientosGuardadosBody.innerHTML=i}).catch(i=>{console.error("Error al filtrar movimientos:",i),this.$refs.movimientosGuardadosBody.innerHTML='<tr><td colspan="6" class="text-center p-4 text-red-500">Error al cargar los movimientos.</td></tr>'})}}))});
